<!DOCTYPE html>  <html> <head>   <title>infinity.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               infinity.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <pre><code>(c) 2012 Airbnb, Inc.

infinity.js may be freely distributed under the terms of the BSD
license. For all licensing information, details, and documention:
http://airbnb.github.com/infinity
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="o">!</span><span class="kd">function</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="nb">Math</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h1>Welcome To Infinity</h1>

<p>infinity.js is a UITableView for the web. Use it to speed up scroll
performance of long- or infinitely-scrolling lists of items.</p>

<p>infinity.js has several caveats:</p>

<ol>
<li><p>All DOM elements must either be visible or in the current layout.
infinity.js does not support elements that will at some point affect the
layout, but are currently hidden using <code>display:none</code>.</p></li>
<li><p>ListViews can't be nested.</p></li>
<li><p>Non-ListItem elements can't be the immediate children of ListView
elements. Only ListItems can be immediate children of ListViews.</p></li>
<li><p>ListView elements can't have heights set directly on them. In most
cases it is also likely that <code>min-height</code>s and <code>max-height</code>s will break.
However, setting heights on ListItems is ok.</p></li>
</ol>

<p>If you're reading this, we probably want to hear from you. If the feeling
is mutual: <a href="http://www.airbnb.com/jobs">get in touch.</a></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h1>Initial Setup</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Cached objects</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">$window</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Packaging:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">oldInfinity</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">infinity</span><span class="p">,</span>
      <span class="nx">infinity</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">infinity</span> <span class="o">=</span> <span class="p">{},</span>
      <span class="nx">config</span> <span class="o">=</span> <span class="nx">infinity</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Constants:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">PAGE_ID_ATTRIBUTE</span> <span class="o">=</span> <span class="s1">&#39;data-infinity-pageid&#39;</span><span class="p">,</span>
      <span class="nx">NUM_BUFFER_PAGES</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
      <span class="nx">PAGES_ONSCREEN</span> <span class="o">=</span> <span class="nx">NUM_BUFFER_PAGES</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Config:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">config</span><span class="p">.</span><span class="nx">PAGE_TO_SCREEN_RATIO</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="nx">config</span><span class="p">.</span><span class="nx">SCROLL_THROTTLE</span> <span class="o">=</span> <span class="mi">350</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h1>ListView Class</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h3>Constructor</h3>

<p>Creates a new instance of a ListView.</p>

<p>Takes:</p>

<ul>
<li><code>$el</code>: a jQuery element.</li>
<li><code>options</code>: an optional hash of options</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">ListView</span><span class="p">(</span><span class="nx">$el</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span> <span class="o">=</span> <span class="nx">blankDiv</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$shadow</span> <span class="o">=</span> <span class="nx">blankDiv</span><span class="p">();</span>
    <span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>don't append the shadow element -- it's meant to only be used for
finding elements outside of the DOM</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">lazy</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">options</span><span class="p">.</span><span class="nx">lazy</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lazyFn</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">lazy</span> <span class="o">||</span> <span class="kc">null</span><span class="p">;</span>

    <span class="nx">initBuffer</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">pages</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="nx">DOMEvent</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h3>initBuffer</h3>

<p>Private ListView method. Initializes the buffer element.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">initBuffer</span><span class="p">(</span><span class="nx">listView</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">listView</span><span class="p">.</span><span class="nx">_$buffer</span> <span class="o">=</span> <span class="nx">blankDiv</span><span class="p">()</span>
                        <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">listView</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h3>updateBuffer</h3>

<p>Private ListView method. Updates the buffer to correctly push forward the
first page.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">updateBuffer</span><span class="p">(</span><span class="nx">listView</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">firstPage</span><span class="p">,</span>
        <span class="nx">pages</span> <span class="o">=</span> <span class="nx">listView</span><span class="p">.</span><span class="nx">pages</span><span class="p">,</span>
        <span class="nx">$buffer</span> <span class="o">=</span> <span class="nx">listView</span><span class="p">.</span><span class="nx">_$buffer</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">pages</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">firstPage</span> <span class="o">=</span> <span class="nx">pages</span><span class="p">[</span><span class="nx">listView</span><span class="p">.</span><span class="nx">startIndex</span><span class="p">];</span>
      <span class="nx">$buffer</span><span class="p">.</span><span class="nx">height</span><span class="p">(</span><span class="nx">firstPage</span><span class="p">.</span><span class="nx">top</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">$buffer</span><span class="p">.</span><span class="nx">height</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h2>ListView manipulation</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h3>append</h3>

<p>Appends a jQuery element or a ListItem to the ListView.</p>

<p>Takes:</p>

<ul>
<li><code>obj</code>: a jQuery element, a string of valid HTML, or a ListItem.</li>
</ul>

<p>TODO: optimized batch appends</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">ListView</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">append</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">obj</span> <span class="o">||</span> <span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">lastPage</span><span class="p">,</span>
        <span class="nx">item</span> <span class="o">=</span> <span class="nx">convertToItem</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">obj</span><span class="p">),</span>
        <span class="nx">pages</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">+=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">height</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>

    <span class="nx">lastPage</span> <span class="o">=</span> <span class="nx">pages</span><span class="p">[</span><span class="nx">pages</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">lastPage</span> <span class="o">||</span> <span class="o">!</span><span class="nx">lastPage</span><span class="p">.</span><span class="nx">hasVacancy</span><span class="p">())</span> <span class="p">{</span>
      <span class="nx">lastPage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Page</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="nx">pages</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">lastPage</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">lastPage</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
    <span class="nx">insertPagesInView</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">item</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h3>cacheCoordsFor</h3>

<p>Caches the coordinates for a given ListItem within the given ListView.</p>

<p>Takes:</p>

<ul>
<li><code>listView</code>: a ListView.</li>
<li><code>listItem</code>: the ListItem whose coordinates you want to cache.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">cacheCoordsFor</span><span class="p">(</span><span class="nx">listView</span><span class="p">,</span> <span class="nx">listItem</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">listItem</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>WARNING: this will always break for prepends. Once support gets added for
prepends, change this.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">listView</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">listItem</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="nx">updateCoords</span><span class="p">(</span><span class="nx">listItem</span><span class="p">,</span> <span class="nx">listView</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
    <span class="nx">listItem</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h3>insertPagesInView</h3>

<p>Inserts any uninserted pages the given ListView owns.</p>

<p>Takes:</p>

<ul>
<li><code>listView</code>: the ListView whose onscreen pages you'd like to insert.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">insertPagesInView</span><span class="p">(</span><span class="nx">listView</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">length</span><span class="p">,</span> <span class="nx">curr</span><span class="p">,</span>
        <span class="nx">pages</span> <span class="o">=</span> <span class="nx">listView</span><span class="p">.</span><span class="nx">pages</span><span class="p">,</span>
        <span class="nx">inserted</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">inOrder</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">index</span> <span class="o">=</span> <span class="nx">listView</span><span class="p">.</span><span class="nx">startIndex</span><span class="p">;</span>
    <span class="nx">length</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">index</span> <span class="o">+</span> <span class="nx">PAGES_ONSCREEN</span><span class="p">,</span> <span class="nx">pages</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="nx">index</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">curr</span> <span class="o">=</span> <span class="nx">pages</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">listView</span><span class="p">.</span><span class="nx">lazy</span><span class="p">)</span> <span class="nx">curr</span><span class="p">.</span><span class="nx">lazyload</span><span class="p">(</span><span class="nx">listView</span><span class="p">.</span><span class="nx">lazyFn</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">inserted</span> <span class="o">&amp;&amp;</span> <span class="nx">curr</span><span class="p">.</span><span class="nx">onscreen</span><span class="p">)</span> <span class="nx">inOrder</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">inOrder</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">curr</span><span class="p">.</span><span class="nx">stash</span><span class="p">(</span><span class="nx">listView</span><span class="p">.</span><span class="nx">$shadow</span><span class="p">);</span>
        <span class="nx">curr</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">listView</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">curr</span><span class="p">.</span><span class="nx">onscreen</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">inserted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">curr</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">listView</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h3>updateStartIndex</h3>

<p>Updates a given ListView when the throttled scroll event fires. Attempts
to do as little work as possible: if the <code>startIndex</code> doesn't change,
it'll exit early. If the <code>startIndex</code> does change, it finds all pages
that have been scrolled out of view and removes them, then inserts only
pages that have been now been scrolled into view.</p>

<p>Takes:</p>

<ul>
<li><code>listView</code>: the ListView needing to be updated.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">updateStartIndex</span><span class="p">(</span><span class="nx">listView</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">length</span><span class="p">,</span> <span class="nx">pages</span><span class="p">,</span> <span class="nx">lastIndex</span><span class="p">,</span> <span class="nx">nextLastIndex</span><span class="p">,</span>
        <span class="nx">startIndex</span> <span class="o">=</span> <span class="nx">listView</span><span class="p">.</span><span class="nx">startIndex</span><span class="p">,</span>
        <span class="nx">viewTop</span> <span class="o">=</span> <span class="nx">$window</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">()</span> <span class="o">-</span> <span class="nx">listView</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span>
        <span class="nx">viewHeight</span> <span class="o">=</span> <span class="nx">$window</span><span class="p">.</span><span class="nx">height</span><span class="p">(),</span>
        <span class="nx">viewBottom</span> <span class="o">=</span> <span class="nx">viewTop</span> <span class="o">+</span> <span class="nx">viewHeight</span><span class="p">,</span>
        <span class="nx">nextIndex</span> <span class="o">=</span> <span class="nx">startIndexWithinRange</span><span class="p">(</span><span class="nx">listView</span><span class="p">,</span> <span class="nx">viewTop</span><span class="p">,</span> <span class="nx">viewBottom</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span> <span class="nx">nextIndex</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">nextIndex</span> <span class="o">===</span> <span class="nx">startIndex</span><span class="p">)</span> <span class="k">return</span> <span class="nx">startIndex</span><span class="p">;</span>

    <span class="nx">pages</span> <span class="o">=</span> <span class="nx">listView</span><span class="p">.</span><span class="nx">pages</span><span class="p">;</span>
    <span class="nx">startIndex</span> <span class="o">=</span> <span class="nx">listView</span><span class="p">.</span><span class="nx">startIndex</span><span class="p">;</span>
    <span class="nx">lastIndex</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">startIndex</span> <span class="o">+</span> <span class="nx">PAGES_ONSCREEN</span><span class="p">,</span> <span class="nx">pages</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
    <span class="nx">nextLastIndex</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">nextIndex</span> <span class="o">+</span> <span class="nx">PAGES_ONSCREEN</span><span class="p">,</span> <span class="nx">pages</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>sweep any invalid old pages</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span><span class="p">(</span><span class="nx">index</span> <span class="o">=</span> <span class="nx">startIndex</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">lastIndex</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">nextIndex</span> <span class="o">||</span> <span class="nx">index</span> <span class="o">&gt;=</span> <span class="nx">nextLastIndex</span><span class="p">)</span>
        <span class="nx">pages</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">stash</span><span class="p">(</span><span class="nx">listView</span><span class="p">.</span><span class="nx">$shadow</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">listView</span><span class="p">.</span><span class="nx">startIndex</span> <span class="o">=</span> <span class="nx">nextIndex</span><span class="p">;</span>

    <span class="nx">insertPagesInView</span><span class="p">(</span><span class="nx">listView</span><span class="p">);</span>
    <span class="nx">updateBuffer</span><span class="p">(</span><span class="nx">listView</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">nextIndex</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h3>remove</h3>

<p>Removes the ListView from the DOM and cleans up after it.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">ListView</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">cleanup</span><span class="p">();</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h3>convertToItem</h3>

<p>Given an object that is either a ListItem instance, a jQuery element, or a
string of valid HTML, makes sure to return either the ListItem itself or
a new ListItem that wraps the element.</p>

<p>Takes:</p>

<ul>
<li><code>listView</code>: the ListView instance that wants the item.</li>
<li><code>possibleItem</code>: an object that is either a ListItem, a jQuery element,
or a string of valid HTML.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">convertToItem</span><span class="p">(</span><span class="nx">listView</span><span class="p">,</span> <span class="nx">possibleItem</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">item</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">possibleItem</span> <span class="k">instanceof</span> <span class="nx">ListItem</span><span class="p">)</span> <span class="k">return</span> <span class="nx">possibleItem</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">possibleItem</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="nx">possibleItem</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">possibleItem</span><span class="p">);</span>
    <span class="nx">item</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ListItem</span><span class="p">(</span><span class="nx">possibleItem</span><span class="p">);</span>
    <span class="nx">cacheCoordsFor</span><span class="p">(</span><span class="nx">listView</span><span class="p">,</span> <span class="nx">item</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">item</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h3>tooSmall</h3>

<p>Alerts the given ListView that the given Page is too small. May result
in modifications to the <code>pages</code> array.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">tooSmall</span><span class="p">(</span><span class="nx">listView</span><span class="p">,</span> <span class="nx">page</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Naive solution:
repartition(listView);</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h3>repartition</h3>

<p>Repartitions the pages array. This can be used for either defragmenting
the array, or recalculating everything on screen resize.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">repartition</span><span class="p">(</span><span class="nx">listView</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">currPage</span><span class="p">,</span> <span class="nx">newPage</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">length</span><span class="p">,</span> <span class="nx">itemIndex</span><span class="p">,</span> <span class="nx">pageLength</span><span class="p">,</span> <span class="nx">currItems</span><span class="p">,</span> <span class="nx">currItem</span><span class="p">,</span>
        <span class="nx">nextItem</span><span class="p">,</span>
        <span class="nx">pages</span> <span class="o">=</span> <span class="nx">listView</span><span class="p">.</span><span class="nx">pages</span><span class="p">,</span>
        <span class="nx">newPages</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="nx">newPage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Page</span><span class="p">(</span><span class="nx">listView</span><span class="p">);</span>
    <span class="nx">newPages</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">newPage</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">pages</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">currPage</span> <span class="o">=</span> <span class="nx">pages</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
      <span class="nx">currItems</span> <span class="o">=</span> <span class="nx">currPage</span><span class="p">.</span><span class="nx">items</span><span class="p">;</span>
      <span class="k">for</span><span class="p">(</span><span class="nx">itemIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">pageLength</span> <span class="o">=</span> <span class="nx">currItems</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">itemIndex</span> <span class="o">&lt;</span> <span class="nx">pageLength</span><span class="p">;</span> <span class="nx">itemIndex</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">currItem</span> <span class="o">=</span> <span class="nx">currItems</span><span class="p">[</span><span class="nx">itemIndex</span><span class="p">];</span>
        <span class="nx">nextItem</span> <span class="o">=</span> <span class="nx">currItem</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">newPage</span><span class="p">.</span><span class="nx">hasVacancy</span><span class="p">())</span> <span class="p">{</span>
          <span class="nx">newPage</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">nextItem</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">newPage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Page</span><span class="p">(</span><span class="nx">listView</span><span class="p">);</span>
          <span class="nx">newPages</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">newPage</span><span class="p">);</span>
          <span class="nx">newPage</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">nextItem</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">currPage</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nx">listView</span><span class="p">.</span><span class="nx">pages</span> <span class="o">=</span> <span class="nx">newPages</span><span class="p">;</span>
    <span class="nx">insertPagesInView</span><span class="p">(</span><span class="nx">listView</span><span class="p">);</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <h2>ListView querying</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h3>find</h3>

<p>Given a selector string or jQuery element, return the items that hold the
given or matching elements.</p>

<p>Note: this is slower than an ordinary jQuery find. However, using jQuery
to find elements will be bug-prone, since most of the elements won't be in
the DOM tree. Caching elements is usually important, but it's even more
important to do here.</p>

<p>Arguments:</p>

<ul>
<li><code>findObj</code>: A selector string, or a jQuery element.</li>
</ul>

<p>Returns a ListItem.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">ListView</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">find</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">findObj</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">items</span><span class="p">,</span> <span class="nx">$onscreen</span><span class="p">,</span> <span class="nx">$offscreen</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>If given a selector string, find everything matching onscreen and
offscreen, and return both.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">findObj</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$onscreen</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">findObj</span><span class="p">);</span>
      <span class="nx">$offscreen</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$shadow</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">findObj</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">$onscreen</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">$offscreen</span><span class="p">));</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Silly option, but might as well.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span><span class="p">(</span><span class="nx">findObj</span> <span class="k">instanceof</span> <span class="nx">ListItem</span><span class="p">)</span> <span class="k">return</span> <span class="p">[</span><span class="nx">findObj</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>jQuery element</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">items</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">findObj</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">pageId</span><span class="p">,</span> <span class="nx">page</span><span class="p">,</span> <span class="nx">pageItems</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">length</span><span class="p">,</span> <span class="nx">currItem</span><span class="p">,</span>
          <span class="nx">$itemEl</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parentsUntil</span><span class="p">(</span><span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="nx">PAGE_ID_ATTRIBUTE</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">).</span><span class="nx">andSelf</span><span class="p">().</span><span class="nx">first</span><span class="p">(),</span>
          <span class="nx">$pageEl</span> <span class="o">=</span> <span class="nx">$itemEl</span><span class="p">.</span><span class="nx">parent</span><span class="p">();</span>


      <span class="nx">pageId</span> <span class="o">=</span> <span class="nx">$pageEl</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">PAGE_ID_ATTRIBUTE</span><span class="p">);</span>
      <span class="nx">page</span> <span class="o">=</span> <span class="nx">PageRegistry</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="nx">pageId</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pageItems</span> <span class="o">=</span> <span class="nx">page</span><span class="p">.</span><span class="nx">items</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">pageItems</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">currItem</span> <span class="o">=</span> <span class="nx">pageItems</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">currItem</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nx">$itemEl</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">currItem</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">items</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <h3>startIndexWithinRange</h3>

<p>Finds the starting index for a listView, given a range. Wraps
indexWithinRange.</p>

<p>Takes:</p>

<ul>
<li><code>listView</code>: the ListView whose startIndex you're calculating.</li>
<li><code>top</code>: the top of the range.</li>
<li><code>bottom</code>: the bottom of the range.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">startIndexWithinRange</span><span class="p">(</span><span class="nx">listView</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">bottom</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">indexWithinRange</span><span class="p">(</span><span class="nx">listView</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">bottom</span><span class="p">);</span>
    <span class="nx">index</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">index</span> <span class="o">-</span> <span class="nx">NUM_BUFFER_PAGES</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="nx">index</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">listView</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">index</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <h3>indexWithinRange</h3>

<p>Finds the index of the page closest to being within a given range. It's
less useful than its wrapper function startIndexWithinRange, and you
probably won't need to call this unwrapped version.</p>

<p>Takes:</p>

<ul>
<li><code>listView</code>: the ListView instance whose pages you're looking at.</li>
<li><code>top</code>: the top of the range.</li>
<li><code>bottom</code>: the bottom of the range.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">indexWithinRange</span><span class="p">(</span><span class="nx">listView</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">bottom</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">length</span><span class="p">,</span> <span class="nx">curr</span><span class="p">,</span> <span class="nx">startIndex</span><span class="p">,</span> <span class="nx">midpoint</span><span class="p">,</span> <span class="nx">diff</span><span class="p">,</span> <span class="nx">prevDiff</span><span class="p">,</span>
        <span class="nx">pages</span> <span class="o">=</span> <span class="nx">listView</span><span class="p">.</span><span class="nx">pages</span><span class="p">,</span>
        <span class="nx">rangeMidpoint</span> <span class="o">=</span> <span class="nx">top</span> <span class="o">+</span> <span class="p">(</span><span class="nx">bottom</span> <span class="o">-</span> <span class="nx">top</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Start looking at the index of the page last contained by the screen --
not the first page in the onscreen pages</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">startIndex</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">listView</span><span class="p">.</span><span class="nx">startIndex</span> <span class="o">+</span> <span class="nx">NUM_BUFFER_PAGES</span><span class="p">,</span>
                          <span class="nx">pages</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">pages</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

    <span class="nx">curr</span> <span class="o">=</span> <span class="nx">pages</span><span class="p">[</span><span class="nx">startIndex</span><span class="p">];</span>
    <span class="nx">midpoint</span> <span class="o">=</span> <span class="nx">curr</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">curr</span><span class="p">.</span><span class="nx">height</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="nx">prevDiff</span> <span class="o">=</span> <span class="nx">rangeMidpoint</span> <span class="o">-</span> <span class="nx">midpoint</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">prevDiff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Search above</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span><span class="p">(</span><span class="nx">index</span> <span class="o">=</span> <span class="nx">startIndex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">index</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">curr</span> <span class="o">=</span> <span class="nx">pages</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
        <span class="nx">midpoint</span> <span class="o">=</span> <span class="nx">curr</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">curr</span><span class="p">.</span><span class="nx">height</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
        <span class="nx">diff</span> <span class="o">=</span> <span class="nx">rangeMidpoint</span> <span class="o">-</span> <span class="nx">midpoint</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">diff</span> <span class="o">&lt;</span> <span class="o">-</span><span class="nx">prevDiff</span><span class="p">)</span> <span class="k">return</span> <span class="nx">index</span><span class="p">;</span>
          <span class="k">return</span> <span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">prevDiff</span> <span class="o">=</span> <span class="nx">diff</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">prevDiff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Search below</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span><span class="p">(</span><span class="nx">index</span> <span class="o">=</span> <span class="nx">startIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">pages</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">curr</span> <span class="o">=</span> <span class="nx">pages</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
        <span class="nx">midpoint</span> <span class="o">=</span> <span class="nx">curr</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">curr</span><span class="p">.</span><span class="nx">height</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
        <span class="nx">diff</span> <span class="o">=</span> <span class="nx">rangeMidpoint</span> <span class="o">-</span> <span class="nx">midpoint</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">diff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="o">-</span><span class="nx">diff</span> <span class="o">&lt;</span> <span class="nx">prevDiff</span><span class="p">)</span> <span class="k">return</span> <span class="nx">index</span><span class="p">;</span>
          <span class="k">return</span> <span class="nx">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">prevDiff</span> <span class="o">=</span> <span class="nx">diff</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">pages</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Perfect hit! Return it.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">startIndex</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <h2>ListView cleanup</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">ListView</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">cleanup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">pages</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">,</span>
        <span class="nx">page</span><span class="p">;</span>
    <span class="nx">DOMEvent</span><span class="p">.</span><span class="nx">detach</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="nx">page</span> <span class="o">=</span> <span class="nx">pages</span><span class="p">.</span><span class="nx">pop</span><span class="p">())</span> <span class="p">{</span>
      <span class="nx">page</span><span class="p">.</span><span class="nx">cleanup</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <h2>ListView event binding</h2>

<p>Internal scroll and resize  binding and throttling. Allows ListViews to
bind to a throttled scroll event (and debounced resize event), and updates
them as it fires.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">DOMEvent</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">eventIsBound</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">scrollScheduled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">resizeTimeout</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">boundViews</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <h3>scrollHandler</h3>

<p>Callback called on scroll. Schedules a <code>scrollAll</code> callback if needed,
and disallows future scheduling.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">scrollHandler</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">scrollScheduled</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">scrollAll</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">SCROLL_THROTTLE</span><span class="p">);</span>
        <span class="nx">scrollScheduled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <h3>scrollAll</h3>

<p>Callback passed to the setTimeout throttle. Calls <code>scrollListView</code> on
every bound ListView, and then allows new scroll events to be
scheduled.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">scrollAll</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">length</span><span class="p">;</span>
      <span class="k">for</span><span class="p">(</span><span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">boundViews</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">updateStartIndex</span><span class="p">(</span><span class="nx">boundViews</span><span class="p">[</span><span class="nx">index</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="nx">scrollScheduled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <h3>resizeHandler</h3>

<p>Callback called on resize. Debounces a <code>resizeAll</code> callback.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">resizeHandler</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">resizeTimeout</span><span class="p">)</span> <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">resizeTimeout</span><span class="p">);</span>
      <span class="nx">resizeTimeout</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resizeAll</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <h3>resizeAll</h3>

<p>Handles resizing all ListViews. Just calls <code>repartition</code> on them for
now.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">resizeAll</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">curr</span><span class="p">;</span>
      <span class="k">for</span><span class="p">(</span><span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">curr</span> <span class="o">=</span> <span class="nx">boundViews</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">repartition</span><span class="p">(</span><span class="nx">curr</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <h3>attach</h3>

<p>Binds a given ListView to a throttled scroll event. Does not create
multiple event handlers if called by multiple ListViews.</p>

<p>Takes:</p>

<ul>
<li><code>listView</code>: a ListView that is not currently bound to the scroll
event.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">attach</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">listView</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">eventIsBound</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">$window</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="nx">scrollHandler</span><span class="p">);</span>
          <span class="nx">$window</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">,</span> <span class="nx">resizeHandler</span><span class="p">);</span>
          <span class="nx">eventIsBound</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">boundViews</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">listView</span><span class="p">);</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <h3>detach</h3>

<p>Detaches a bound ListView from the throttled scroll event. If no
ListViews remain bound to the throttled scroll, unbinds the scroll
handler from the window's scroll event.</p>

<p>Returns true if the listView was successfully detached, and false
otherwise.</p>

<p>Takes:</p>

<ul>
<li><code>listView</code>: a ListView that is currently bound to the scroll event.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">detach</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">listView</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">length</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">boundViews</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">boundViews</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">===</span> <span class="nx">listView</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">boundViews</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">boundViews</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">$window</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="nx">scrollHandler</span><span class="p">);</span>
              <span class="nx">$window</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">,</span> <span class="nx">resizeHandler</span><span class="p">);</span>
              <span class="nx">eventIsBound</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}());</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <h1>Page class</h1>

<p>An internal class used for ordering items into roughly screen-sized pages.
Pages are removed and added to the DOM wholesale as they come in and out
of view.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">Page</span><span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">items</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span> <span class="o">=</span> <span class="nx">blankDiv</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">PageRegistry</span><span class="p">.</span><span class="nx">generatePageId</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">PAGE_ID_ATTRIBUTE</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bottom</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">lazyloaded</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">onscreen</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <h3>append</h3>

<p>Appends a ListItem to the Page.</p>

<p>Takes:</p>

<ul>
<li><code>item</code>: a ListItem.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">append</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">items</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Recompute coords, sizing.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span><span class="p">(</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bottom</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">bottom</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">width</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">bottom</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>

    <span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">lazyloaded</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <h3>prepend</h3>

<p>Prepends a ListItem to the Page.</p>

<p>Takes:</p>

<ul>
<li><code>item</code>: a ListItem.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">prepend</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">items</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Recompute coords, sizing.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">bottom</span> <span class="o">+=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">width</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">bottom</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>

    <span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">prepend</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">lazyloaded</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <h3>hasVacancy</h3>

<p>Returns false if the Page is at max capacity; false otherwise.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasVacancy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">&lt;</span> <span class="nx">$window</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">*</span> <span class="nx">config</span><span class="p">.</span><span class="nx">PAGE_TO_SCREEN_RATIO</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <h3>appendTo</h3>

<p>Proxies to jQuery to append the Page to the given jQuery element.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">appendTo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$el</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">onscreen</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$el</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">onscreen</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <h3>prependTo</h3>

<p>Proxies to jQuery to prepend the Page to the given jQuery element.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">prependTo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$el</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">onscreen</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">$el</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">onscreen</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <h3>stash</h3>

<p>Temporarily stash the onscreen page under a different element.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">stash</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$el</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onscreen</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$el</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">onscreen</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <h3>remove</h3>

<p>Removes the Page from the DOM and cleans up after it.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onscreen</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">onscreen</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">cleanup</span><span class="p">();</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <h3>cleanup</h3>

<p>Cleans up the Page without removing it.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">cleanup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">items</span><span class="p">,</span>
        <span class="nx">item</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nx">PageRegistry</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">item</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">pop</span><span class="p">())</span> <span class="p">{</span>
      <span class="nx">item</span><span class="p">.</span><span class="nx">cleanup</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <h3>lazyload</h3>

<p>Runs the given lazy-loading callback on all unloaded page content.</p>

<p>Takes:</p>

<ul>
<li><code>callback</code>: a function of the form <code>function([$el]){}</code>. Will run on
each unloaded element, and will use the element as its calling context.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">lazyload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">$el</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">,</span>
        <span class="nx">index</span><span class="p">,</span> <span class="nx">length</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">lazyloaded</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">$el</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">$el</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span> <span class="nx">$el</span><span class="p">[</span><span class="nx">index</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">lazyloaded</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <h2>Page Registry</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">PageRegistry</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">pages</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">generatePageId</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">pages</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">lookup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">pages</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">||</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">remove</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">page</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">pages</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">pages</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}());</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <h3>removeItemFromPage</h3>

<p>Removes a given ListItem from the given Page.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">removeItemFromPage</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">length</span><span class="p">,</span> <span class="nx">foundIndex</span><span class="p">,</span>
        <span class="nx">items</span> <span class="o">=</span> <span class="nx">page</span><span class="p">.</span><span class="nx">items</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">items</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">===</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">foundIndex</span> <span class="o">=</span> <span class="nx">index</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">foundIndex</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

    <span class="nx">items</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">foundIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nx">page</span><span class="p">.</span><span class="nx">bottom</span> <span class="o">-=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
    <span class="nx">page</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">page</span><span class="p">.</span><span class="nx">bottom</span> <span class="o">-</span> <span class="nx">page</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">page</span><span class="p">.</span><span class="nx">hasVacancy</span><span class="p">())</span> <span class="nx">tooSmall</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">page</span><span class="p">);</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <h1>ListItem class</h1>

<p>An individual item in the ListView.</p>

<p>Has cached top, bottom, width, and height properties, determined from
jQuery. This positioning data will be determined when the ListItem is
inserted into a ListView; it can't be determined ahead of time.</p>

<p>All positioning data is relative to the containing ListView.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">ListItem</span><span class="p">(</span><span class="nx">$el</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span> <span class="o">=</span> <span class="nx">$el</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bottom</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <h3>clone</h3>

<p>Clones the ListItem.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">ListItem</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clone</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ListItem</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">bottom</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">bottom</span><span class="p">;</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">item</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <h3>remove</h3>

<p>Removes the ListItem and its elements from the page, and cleans up after
them.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">ListItem</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
    <span class="nx">removeItemFromPage</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">cleanup</span><span class="p">();</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <h3>cleanup</h3>

<p>Cleans up after the ListItem without removing it from the page.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">ListItem</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">cleanup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <h3>updateCoords</h3>

<p>Updates the coordinates of the given ListItem, assuming a given y-offset
from the parent ListView.</p>

<p>Takes:</p>

<ul>
<li><code>listItem</code>: the ListItem whose cached coordinates you want to update.</li>
<li><code>yOffset</code>: the y-offset of the ListItem from its ListView parent.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">updateCoords</span><span class="p">(</span><span class="nx">listItem</span><span class="p">,</span> <span class="nx">yOffset</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">$el</span> <span class="o">=</span> <span class="nx">listItem</span><span class="p">.</span><span class="nx">$el</span><span class="p">;</span>

    <span class="nx">listItem</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">yOffset</span><span class="p">;</span>
    <span class="nx">listItem</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">$el</span><span class="p">.</span><span class="nx">outerHeight</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="nx">listItem</span><span class="p">.</span><span class="nx">bottom</span> <span class="o">=</span> <span class="nx">listItem</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">listItem</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
    <span class="nx">listItem</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">$el</span><span class="p">.</span><span class="nx">width</span><span class="p">();</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <h1>Helper functions</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <h3>blankDiv</h3>

<p>Returns a new, empty <code>&lt;div&gt;</code> jQuery element. The <code>&lt;div&gt;</code> will have its
border, margin, and padding set to zero or none, as appropriate.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">blankDiv</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span>
      <span class="nx">margin</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">padding</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">border</span><span class="o">:</span> <span class="s1">&#39;none&#39;</span>
    <span class="p">});</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <h3>pxToInt</h3>

<p>Converts pixel values returned by jQuery to base-10 ints.</p>

<p>Takes:</p>

<ul>
<li><code>px</code>: a string value, which starts with a number and is
postfixed with the string <code>'px'</code>.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>function pxToInt(px) {
 return parseInt(px, 10);
}</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <h1>Export</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>Classes:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">infinity</span><span class="p">.</span><span class="nx">ListView</span> <span class="o">=</span> <span class="nx">ListView</span><span class="p">;</span>
  <span class="nx">infinity</span><span class="p">.</span><span class="nx">Page</span> <span class="o">=</span> <span class="nx">Page</span><span class="p">;</span>
  <span class="nx">infinity</span><span class="p">.</span><span class="nx">ListItem</span> <span class="o">=</span> <span class="nx">ListItem</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>jQuery plugin</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">registerPlugin</span><span class="p">(</span><span class="nx">infinity</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ListView</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">infinity</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ListView</span> <span class="o">=</span> <span class="nx">infinity</span><span class="p">.</span><span class="nx">ListView</span><span class="p">;</span>

      <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">listView</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">ListView</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="k">delete</span> <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">listView</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">registerPlugin</span><span class="p">(</span><span class="nx">infinity</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>Destroy own packaging:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">infinity</span><span class="p">.</span><span class="nx">noConflict</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">infinity</span> <span class="o">=</span> <span class="nx">oldInfinity</span><span class="p">;</span>
    <span class="nx">registerPlugin</span><span class="p">(</span><span class="nx">oldInfinity</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">infinity</span><span class="p">;</span>
  <span class="p">};</span>

<span class="p">}(</span><span class="nb">window</span><span class="p">,</span> <span class="nb">Math</span><span class="p">,</span> <span class="nx">jQuery</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html>